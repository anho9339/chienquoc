#include <equip.h>
// 变量：武器文件列表

string *FileTable00b = ({
        "/item/70/0002",
        "/item/72/0002",
        "/item/74/0002",
        "/item/75/0002",
        "/item/76/0002",
});

int sizeof_file_00b = sizeof(FileTable00b);

string *FileTable10b = ({
        "/item/70/0010",
        "/item/71/1010",
        "/item/72/0010",
        "/item/74/0010",
        "/item/75/0010",
        "/item/76/0010",
        "/item/77/1010",
        "/item/77/1015",
        "/item/78/1010",
        "/item/78/1015",
        "/item/79/1010",
        "/item/79/1015",
});

int sizeof_file_10b = sizeof(FileTable10b);

string *FileTable20b = ({
        "/item/70/1020",
        "/item/71/1020",
        "/item/72/1020",
        "/item/74/1020",
        "/item/75/1020",
        "/item/76/0020",
        "/item/77/1020",
        "/item/78/1020",
        "/item/79/1020",
        "/item/70/1025",
        "/item/71/1025",
        "/item/72/1025",
        "/item/74/1025",
        "/item/75/1025",
        "/item/76/1025",
        "/item/77/1025",
        "/item/78/1025",
        "/item/79/1025",
});

int sizeof_file_20b = sizeof(FileTable20b);

string *FileTable30b = ({
        "/item/70/1030",
        "/item/71/1030",
        "/item/72/1030",
        "/item/74/1030",
        "/item/76/1030",
        "/item/75/1030",
        "/item/77/1030",
        "/item/78/1030",
        "/item/79/1030",
        "/item/70/1035",
        "/item/71/1035",
        "/item/72/1035",
        "/item/74/1035",
        "/item/76/1035",
        "/item/75/1035",
        "/item/77/1035",
        "/item/78/1035",
        "/item/79/1035",
});

int sizeof_file_30b = sizeof(FileTable30b);

string *FileTable40b = ({
        "/item/70/1040",
        "/item/71/1040",
        "/item/72/1040",
        "/item/74/1040",
        "/item/75/1040",
        "/item/76/1040",
        "/item/77/1040",
        "/item/78/1040",
        "/item/79/1040",
        "/item/70/1045",
        "/item/71/1045",
        "/item/72/1045",
        "/item/74/1045",
        "/item/75/1045",
        "/item/76/1045",
        "/item/77/1045",
        "/item/78/1045",
        "/item/79/1045",
});

int sizeof_file_40b = sizeof(FileTable40b);

string *FileTable50b = ({
        "/item/70/1050",
        "/item/71/1050",
        "/item/72/1050",
        "/item/74/1050",
        "/item/76/1050",
        "/item/75/1050",
        "/item/77/1050",
        "/item/78/1050",
        "/item/79/1050",
        "/item/70/1055",
        "/item/71/1055",
        "/item/72/1055",
        "/item/74/1055",
        "/item/76/1055",
        "/item/75/1055",
        "/item/77/1055",
        "/item/78/1055",
        "/item/79/1055",
});

int sizeof_file_50b = sizeof(FileTable50b);

string *FileTable30 = ({
        "/item/70/1030",
        "/item/71/1030",
        "/item/72/1030",
        "/item/74/1030",
        "/item/75/1030",
        "/item/76/1030",
        "/item/77/1030",
        "/item/78/1030",
        "/item/79/1030",

        "/item/70/1035",
        "/item/71/1035",
        "/item/72/1035",
        "/item/74/1035",
        "/item/75/1035",
        "/item/76/1035",
        "/item/77/1035",
        "/item/78/1035",
        "/item/79/1035",
});

int sizeof_file_30 = sizeof(FileTable30);

string *FileTable40 = ({
        "/item/70/1040",
        "/item/71/1040",
        "/item/72/1040",
        "/item/74/1040",
        "/item/76/1040",
        "/item/75/1040",
        "/item/77/1040",
        "/item/78/1040",
        "/item/79/1040",

        "/item/70/1045",
        "/item/71/1045",
        "/item/72/1045",
        "/item/74/1045",
        "/item/76/1045",
        "/item/75/1045",
        "/item/77/1045",
        "/item/78/1045",
        "/item/79/1045",
});

int sizeof_file_40 = sizeof(FileTable40);

string *FileTable50 = ({
        "/item/70/1050",
        "/item/71/1050",
        "/item/72/1050",
        "/item/74/1050",
        "/item/75/1050",
        "/item/76/1050",
        "/item/77/1050",
        "/item/78/1050",
        "/item/79/1050",

        "/item/70/1055",
        "/item/71/1055",
        "/item/72/1055",
        "/item/74/1055",
        "/item/75/1055",
        "/item/76/1055",
        "/item/77/1055",
        "/item/78/1055",
        "/item/79/1055",
});

int sizeof_file_50 = sizeof(FileTable50);

string *FileTable60 = ({
        "/item/70/1060",
        "/item/71/1060",
        "/item/72/1060",
        "/item/74/1060",
        "/item/76/1060",
        "/item/75/1060",
        "/item/77/1060",
        "/item/78/1060",
        "/item/79/1060",

        "/item/70/1065",
        "/item/71/1065",
        "/item/72/1065",
        "/item/74/1065",
        "/item/76/1065",
        "/item/75/1065",
        "/item/77/1065",
        "/item/78/1065",
        "/item/79/1065",
});

int sizeof_file_60 = sizeof(FileTable60);

string *FileTable70 = ({
        "/item/70/1070",
        "/item/71/1070",
        "/item/72/1070",
        "/item/74/1070",
        "/item/76/1070",
        "/item/75/1070",
        "/item/77/1070",
        "/item/78/1070",
        "/item/79/1070",
});

int sizeof_file_70 = sizeof(FileTable70);

string *FileTable80 = ({
        "/item/70/1080",
        "/item/71/1080",
        "/item/72/1080",
        "/item/74/1080",
        "/item/75/1080",
        "/item/76/1080",
        "/item/77/1080",
        "/item/78/1080",
        "/item/79/1080",
});

int sizeof_file_80 = sizeof(FileTable80);

string *FileTable90 = ({
        "/item/70/1090",
        "/item/71/1090",
        "/item/72/1090",
        "/item/74/1090",
        "/item/75/1090",
        "/item/76/1090",
        "/item/77/1090",
        "/item/78/1090",
        "/item/79/1090",
});

int sizeof_file_90 = sizeof(FileTable90);

string *FileTable100 = ({
        "/item/70/1100",
        "/item/71/1100",
        "/item/72/1100",
        "/item/74/1100",
        "/item/75/1100",
        "/item/76/1100",
        "/item/77/1100",
        "/item/78/1100",
        "/item/79/1100",
});

int sizeof_file_100 = sizeof(FileTable100);

string *FileTable110 = ({
        "/item/70/1110",
        "/item/71/1110",
        "/item/72/1110",
        "/item/74/1110",
        "/item/75/1110",
        "/item/76/1110",
        "/item/77/1110",
        "/item/78/1110",
        "/item/79/1110",
});

int sizeof_file_110 = sizeof(FileTable110);

string *FileTable120 = ({
        "/item/70/1120",
        "/item/71/1120",
        "/item/72/1120",
        "/item/74/1120",
        "/item/75/1120",
        "/item/76/1120",
        "/item/77/1120",
        "/item/78/1120",
        "/item/79/1120",
});

int sizeof_file_120 = sizeof(FileTable120);

// 函数：按等级获取武器
string get_weapon_file( int level )
{
        switch( level / 10 )
        {
      default : return FileTable00b[ random(sizeof_file_00b) ];
       case 1 : return FileTable10b[ random(sizeof_file_10b) ];
       case 2 : return FileTable20b[ random(sizeof_file_20b) ];
       case 3 : return FileTable30[ random(sizeof_file_30) ];
       case 4 : return FileTable40[ random(sizeof_file_40) ];
       case 5 : return FileTable50[ random(sizeof_file_50) ];
       case 6 : return FileTable60[ random(sizeof_file_60) ];
       case 7 : return FileTable70[ random(sizeof_file_70) ];
       case 8 : return FileTable80[ random(sizeof_file_80) ];
       case 9 : return FileTable90[ random(sizeof_file_90) ];
      case 10 : return FileTable100[ random(sizeof_file_100) ];
      case 11 : return FileTable110[ random(sizeof_file_110) ];
      case 12 :
      case 13 : case 14 : case 15 :
                return FileTable120[ random(sizeof_file_120) ];
        }
}

// 函数：按等级获取武器(基本)
string get_weapon_file_0( int level )
{
        switch( level / 10 )
        {
      default : return FileTable00b[ random(sizeof_file_00b) ];
       case 1 : return FileTable10b[ random(sizeof_file_10b) ];
       case 2 : return FileTable20b[ random(sizeof_file_20b) ];
       case 3 : return FileTable30b[ random(sizeof_file_30b) ];
       case 4 : return FileTable40b[ random(sizeof_file_40b) ];
       case 5 : return FileTable50b[ random(sizeof_file_50b) ];
        }
}

// 函数：按等级获取武器(门派)
string get_weapon_file_2( int level )
{
        switch( level / 10 )
        {
      default : return FileTable00b[ random(sizeof_file_00b) ];
       case 1 : return FileTable10b[ random(sizeof_file_10b) ];
       case 2 : return FileTable20b[ random(sizeof_file_20b) ];
       case 3 : return FileTable30[ random(sizeof_file_30) ];
       case 4 : return FileTable40[ random(sizeof_file_40) ];
       case 5 : return FileTable50[ random(sizeof_file_50) ];
       case 6 : return FileTable60[ random(sizeof_file_60) ];
       case 7 : return FileTable70[ random(sizeof_file_70) ];
       case 8 : return FileTable80[ random(sizeof_file_80) ];
       case 9 : return FileTable90[ random(sizeof_file_90) ];
      case 10 : return FileTable100[ random(sizeof_file_100) ];
      case 11 : return FileTable110[ random(sizeof_file_110) ];
      case 12 :
      case 13 : case 14 : case 15 :
                return FileTable120[ random(sizeof_file_120) ];
        }
}

// 函数：按等级段获取装备(门派)
string get_weapon_file_3( int level1, int level2 ) 
{ 
	int begin, end, i;
	string * all;
	begin = level1 /10; end = level2/10;
	if (begin>end)
	{
		i = begin;
		begin = end;
		end = i;
	}
	all = ({ });
	for (i = begin; i<=end;i++)
	{
	        all += ({ get_weapon_file_2(i*10) });
	}
	if (sizeof(all)>0) return all[random(sizeof(all))];
	else  return FileTable00b[ random(sizeof_file_00b) ];  
}

string * get_family_equip(string family, int sex, int level, int equip)
{
	string result1="", result2="" ,*ret = ({ });
	int famtype = -1;
	switch(equip)
	{
	case HEAD_TYPE:
		result1 = "/item/65";
		result2 = "/item/66";
		if (sex==1) result2 = "";
		if (sex==2) result1 = "";
		break;
	case NECK_TYPE:
		result1 = "/item/86";
		break;
	case WEAPON_TYPE:
		switch(family)
		{
		case "Đào Hoa Nguyên":
			result1 = "/item/70";
			break;
		case "Thục Sơn":
			result1 = "/item/72";
			result2 = "/item/76";
			break;
		case "Cấm Vệ Quân":
			result1 = "/item/74";
			result2 = "/item/75";
			break;
		case "Đường Môn":
			result1 = "/item/71";
			break;
		case "Mao Sơn":
			result1 = "/item/77";
			break;
		case "Côn Luân":
			result1 = "/item/78";
			break;
		case "Vân Mộng Cốc":
			result1 = "/item/79";
			break;
		}
		break;
	case ARMOR_TYPE:
		result1 = "/item/60";
		result2 = "/item/61";
		if (sex==1) result2 = "";
		if (sex==2) result1 = "";
		break;
	case WAIST_TYPE:
		result1 = "/item/87";
		break;
	case BOOTS_TYPE:
		result1 = "/item/88";
		break;
	}
	if (equip!=WEAPON_TYPE)
	{
                switch(family)
                {
                default:
                	famtype = 0;
                	break;
                case "Đào Hoa Nguyên":
                	famtype = 1;
                	break;
                case "Thục Sơn":
                	famtype = 2;
                	break;
                case "Cấm Vệ Quân":
                	famtype = 3;
                	break;
                case "Đường Môn":
                	famtype = 4;
                	break;
                case "Mao Sơn":
                	famtype = 5;
                	break;
                case "Côn Luân":
                	famtype = 6;
                	break;
                case "Vân Mộng Cốc":
                	famtype = 7;
                	break;
                }
	}
	else
	{
		if (family=="")
			famtype = 0;
		else
			famtype = 1;
	}
	//判断有无相应的5级以内的装备
	level = (level /5 *5);
	if ( level == 75 )
		level = 70;	//神器材料75级
	if (result1!="")
	{
		if (!load_object(sprintf("%s/%04d", result1, famtype*1000+level))) level = level/10*10;
		if (load_object(sprintf("%s/%04d", result1, famtype*1000+level)))
			ret += ({ sprintf("%s/%04d", result1, famtype*1000+level) });
	}
	if (result2!="")
	{
		if (!load_object(sprintf("%s/%04d", result2, famtype*1000+level))) level = level/10*10;
		if (load_object(sprintf("%s/%04d", result2, famtype*1000+level)))
			ret += ({ sprintf("%s/%04d", result2, famtype*1000+level) });
	}
	if (sizeof(ret)==0)
		ret = ({"item/74/0010","item/75/0010"});
	return ret;
}

void check_item()
{
	int i, size;
	size = sizeof(FileTable00b);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable00b[i]))
		{
			log_file("test.dat", FileTable00b[i]+" error\n");
		}
	size = sizeof(FileTable10b);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable10b[i]))
		{
			log_file("test.dat", FileTable10b[i]+" error\n");
		}
	size = sizeof(FileTable20b);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable20b[i]))
		{
			log_file("test.dat", FileTable20b[i]+" error\n");
		}
	size = sizeof(FileTable30);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable30[i]))
		{
			log_file("test.dat", FileTable30[i]+" error\n");
		}
	size = sizeof(FileTable40);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable40[i]))
		{
			log_file("test.dat", FileTable40[i]+" error\n");
		}
	size = sizeof(FileTable50);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable50[i]))
		{
			log_file("test.dat", FileTable50[i]+" error\n");
		}
	size = sizeof(FileTable60);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable60[i]))
		{
			log_file("test.dat", FileTable60[i]+" error\n");
		}
	size = sizeof(FileTable70);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable70[i]))
		{
			log_file("test.dat", FileTable70[i]+" error\n");
		}
	size = sizeof(FileTable80);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable80[i]))
		{
			log_file("test.dat", FileTable80[i]+" error\n");
		}
	size = sizeof(FileTable90);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable90[i]))
		{
			log_file("test.dat", FileTable90[i]+" error\n");
		}
	size = sizeof(FileTable100);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable100[i]))
		{
			log_file("test.dat", FileTable100[i]+" error\n");
		}
	size = sizeof(FileTable110);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable110[i]))
		{
			log_file("test.dat", FileTable110[i]+" error\n");
		}
	size = sizeof(FileTable120);
	for (i = 0;i<size;i++)
		if(!load_object(FileTable120[i]))
		{
			log_file("test.dat", FileTable120[i]+" error\n");
		}
}

//获取套装(0为随机)
string get_suit_file(string fam_name, int level, int equip)
{
	int *nEquip=({HEAD_TYPE,ARMOR_TYPE,NECK_TYPE,WAIST_TYPE,BOOTS_TYPE});
	int i,size,family;
	string dir,file,*nFile=({});
	mixed mxTmp;
	
	if ( !equip )
		equip = nEquip[random(sizeof(nEquip))]; 
	switch(equip)
	{
	default :
	case HEAD_TYPE:
		dir = "/item/55/";
		break;
	case ARMOR_TYPE:
		dir = "/item/56/";
		break;
	case NECK_TYPE:
		dir = "/item/57/";
		break;
	case WAIST_TYPE:
		dir = "/item/58/";
		break;
	case BOOTS_TYPE:
		dir = "/item/59/";
		break;
	}	
	switch(fam_name)
	{
	case "Đào Hoa Nguyên":
		family = 1;
		break;
	case "Thục Sơn":
		family = 2;
		break;
	case "Cấm Vệ Quân":
		family = 3;
		break;
	case "Đường Môn":
		family = 4;
		break;
	case "Mao Sơn":
		family = 5;
		break;
	case "Côn Luân":
		family = 6;
		break;
	case "Vân Mộng Cốc":
		family = 7;
		break;
	default :
		family = 1 + random(7);
	}
		
	if ( level )
	{
		file = dir + sprintf("%d",family)+sprintf("%03d",level);
			
	}
	else
	{
		mxTmp = get_dir(dir);
		for(i=0,size=sizeof(mxTmp);i<size;i++)
		{
			if ( to_int(mxTmp[i][0..0]) == family )
				nFile += ({ mxTmp[i] }); 	
		}
		if ( size=sizeof(nFile) )
			file = dir+nFile[random(size)];
		else
			file = "/item/55/1055";
	}
	if ( !load_object(file) )
		file = "/item/55/1055";
	return file;
}