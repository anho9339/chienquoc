#include <ansi.h>

mapping Locate = ([
	"13"	: ({ 132,104,133,173,134,98,136,200,117,135,117,163,117,173,117,190,120,182,150,129,151,87,176,131,176,199,189,128,189,190,227,151,46,145,48,137,59,152,60,142,65,127,126,125,126,184,141,93,144,86, }),
	"21"	: ({ 83,87,83,108,84,56,95,45,98,90,104,122,112,92,114,97,120,136,121,113,52,103,55,111,57,79,60,95,61,108,68,64,74,105,78,86,80,109,129,99,129,125,136,55,137,101,142,58,144,117,148,135,148,142,157,48,159,82,178,110,181,54,194,98,196,84,158,138,159,65,169,114,99,50,100,96,102,93,159,127,173,95,175,111,159,90,176,91,183,58,183,71,186,77,197,90, }),
	"41"	: ({ 140,131,142,99,167,98,173,108,176,90,184,97,62,105,109,60,67,104,69,74,71,98,128,75,132,74,126,45,140,53, }),
	"42"	: ({ 137,97,144,108,148,87,150,157,340,104,343,149,348,130,348,210,350,200,351,137,388,178,389,179,390,176,196,176,257,247,315,241,232,120,236,224,239,112,263,221,264,229,166,161,171,123,173,143,334,118,336,125,342,156,358,144,381,172,332,114,337,156,339,126,269,155,271,107,277,171,229,116,265,102,265,176,390,184,391,178,391,180,393,178,351,150,360,200,361,126,394,149,399,157,381,174,383,170,383,173,383,175,384,171,386,173, }),
	"43"	: ({ 167,98,172,76,174,69,175,128,191,124,192,64,195,114,44,104,137,51,126,80,134,53,77,71,82,77,166,169,167,72,183,56,89,79,112,96,113,113,142,71,181,93,179,116,124,53,36,92,156,137,115,105,118,106,141,68,158,71,175,132,185,163,191,62,194,98,203,75, }),
	"81"	: ({ 202,166,204,153,221,158,224,174,83,54,83,65,123,97,182,141,196,162,201,133,205,138,138,102,136,88,187,130,189,147,194,135,216,146,216,160,216,167,232,162,220,133,114,115,171,134,176,92,240,164,243,161,178,103, }),
	"82"	: ({ 155,131,167,137,168,124,170,90,191,144,192,89,193,75,203,124,204,115,146,103,147,65,152,140,180,127,192,89,193,75,194,66,190,67,199,135,201,110,191,113,161,84,162,101,163,122,179,144,128,152,142,148, }),
	"111"	: ({ 118,139,156,146,184,90,187,133,191,108,195,80,196,140,134,176,163,160,169,88,207,94,217,121,111,90,114,107,121,95,34,98,39,93,43,106,45,110,94,134, }),
	"112"	: ({ 137,149,138,70,138,102,138,132,154,125,157,114,160,151,161,171,85,91,86,96,87,108,51,93,72,81,72,100,76,71,185,71,210,99,210,116,225,101,163,99,191,88, }),
	"141"	: ({ 227,167,228,207,168,139,172,102,179,161,183,150,185,167,207,151,174,157,208,171,211,192,222,150,222,211,223,182,216,181,227,125,173,150,214,145,216,196,204,137,215,161,216,117,154,109,156,139,51,57,63,61,167,147,168,118, }),
	"142"	: ({ 181,60,188,152,190,91,191,86,249,98,249,107,254,112,143,163,146,32,146,110,175,136,176,57,176,64,213,104,214,110,156,162,95,116,102,52,121,162,257,103,127,30,129,34,136,36,233,124,217,118,126,51,130,43, }),
	"181"	: ({ 169,112,195,56,198,32,225,91,228,47,233,78,27,149,33,143,213,82,213,103,79,114,79,152,86,188,93,139,37,160,40,151,36,139,55,127,136,114,136,151,152,100,233,88,234,68,207,45, }),
	"182"	: ({ 153,67,153,150,178,125,179,62,182,108,184,127,185,74,188,104,139,154,148,126,148,154,149,92,149,159,159,93,161,116,162,62,168,114,192,67,199,113,203,106,204,87,208,83,210,110,213,100,217,93, }),	
	"211"	: ({ 138,159,152,45,154,134,154,151,178,89,179,137,175,60,197,111,199,105,138,108,183,71,185,131,207,98,95,128,101,62,117,53,102,103,108,154,144,134,126,68,133,109,120,139,121,153,137,137, }),
	"231"	: ({ 56,95,60,80,72,76,86,128,138,64,140,110,142,158,144,85,190,56,193,121,196,68,233,109,241,88,245,95,252,104,86,145,88,67,96,70,105,142,107,136, }),
	"241"	: ({ 143,78,117,116,118,52,119,92,121,63,97,103,102,84,104,106,109,30,121,124, }),
	"242"	: ({ 126,59,128,82,129,122,65,57,68,68,70,99,71,54,57,66,60,85,75,82,76,48,76,103,78,85,81,88,122,34,130,101,134,94, }),
	"251"	: ({ 196,114,203,102,203,126,205,57,217,108,218,47,218,61,182,90,182,121,183,103,196,53,221,69,223,45,224,106,188,121,189,44,191,74,208,40,209,79,211,105,249,99,180,69,180,118,225,29,157,131,226,90,228,37,178,100, }),
	"261"	: ({ 77,129,149,139,151,99,151,156,153,136,156,126,158,106,168,122,142,84,127,96,143,101,159,128,162,114,165,143,43,103,47,110,62,127, }),
	"262"	: ({ 75,63,78,49,87,67,89,44,93,82,94,28,96,43,100,67,102,86,103,44,108,30,110,49,115,100,116,44,121,75,123,59,126,77,129,44,129,104,131,51,136,79,136,90,142,84,144,98,151,108,156,123,159,102,187,136,212,155,222,173,243,186,245,196,249,207,251,175,267,193,274,217,307,220,311,209, }),
	"265"	: ({ 64,85,67,100,86,90,99,106,104,95,105,65,106,99,207,186,210,204,143,157,145,164,211,108,214,101,214,113,249,222,256,209,256,218,86,128,99,36,134,112,135,119,149,69,153,86,157,66,157,79,200,156,201,176,202,123, }),
	"266"	: ({ 123,151,125,125,126,65,58,130,64,105,67,132,148,184,149,178,151,33,208,92,209,119,217,131,216,140,153,18,153,167,155,196,156,26,189,61,195,140,198,78,201,97,126,72,58,99, }),
	"271"	: ({ 172,40,173,55,177,194,81,140,238,142,202,184,204,87,205,178,208,99,233,148,222,71,247,115,249,139,250,117,250,123,81,138,179,91,202,63,208,112,214,121,175,116,188,136, }),
	"272"	: ({ 117,54,136,90,137,135,139,36,162,54,234,122,163,140,186,146,199,133,162,128,163,134,200,115,201,86,205,137,232,103,183,39,184,119, }),
	"281"	: ({ 77,159,79,148,79,180,86,123,88,122,88,148,91,157,98,152,100,109,134,123,141,76,150,55,155,64,75,132,100,136,101,114,123,99,124,100,124,152,188,46,191,24,247,67,255,60,30,146,31,152,31,156,34,142,51,143,54,169,58,177,61,174,71,112,71,189,206,73,210,29,217,74,220,33,230,55,231,41,156,100,173,79,180,71,180,116, }),
	"282"	: ({ 84,59,87,93,87,130,88,67,104,43,104,95,110,64,110,76,118,51,120,95,141,101,143,123,147,77,148,153,153,48,132,163,134,108,140,161,154,116,158,89,164,147,175,129,176,65,186,120,29,93,31,91,49,96,50,108,60,92,66,89,66,124,74,88,77,127,121,160,124,144,125,41,126,65,131,146,132,44,167,121,170,71,153,106, }),
	"283"	: ({ 54,169,64,143,77,131,83,165,84,143,87,154,90,148,95,111,102,99,114,89,120,89,128,80,30,147,34,158,42,163,43,136,48,140,54,129,140,119,155,89,156,73,168,69,171,80,76,156,128,107,130,94,134,97,139,90,145,92,207,53,210,62,92,140,195,38,201,36,204,29,205,67,218,58,180,46,183,64, }),
	"284"	: ({ 97,80,106,47,108,66,115,54,121,106,125,75,139,105,141,71,188,162,190,134,199,124,200,183,148,82,149,77,164,148,167,163,172,111,175,100,211,174,223,196,232,156,235,158,52,65,53,40,56,55,64,74,79,83,82,34,90,80,93,42,146,123,238,186,245,198,267,172,274,165,274,185,205,140,210,121,211,148,250,151,262,163, }),	
	]);

string * place1 = ({ "21", "41", "42", "43", "81", "82", "141", "211", "251", "281", "282", "283", "284", });
string * place2 = ({ "21", "41", "42", "43", "81", "82", "141", "211", "251", "281", "282", "283", "284", });
string * place3 = ({ "41", "42", "43", "81", "82", "141", "211", "251", "281", "282", "283", "284", });
string * place4 = ({ "21", "42", "43", "81", "251", "281", "282", "283", "284", });
string * place5 = ({ "141", "142", "181", "182", "241", "243", "261", "262", "265", "266", "271", "272", });
string * place6 = ({ "141", "142", "181", "182", "243", "262", "265", "266", "271", "272", });
string * place7 = ({ "142", "181", "182", "241", "242", "265", "266", "271", "272", });
string * place8 = ({ "13", "111", "112", "231", "242", "262", "265", });

object * stuffs = ({ });	

// 函数：生成二进制码
void SAVE_BINARY() { }

int get_xy(int z)
{
	int * pos, size, i, p;
	string name = sprintf("%d", z);
	pos =  Locate[name];
	if (!pos) pos = Locate["281"];
	size = sizeof(pos);
	i = random(size/2);
	p = get_valid_xy(z, pos[i*2], pos[i*2+1], IS_CHAR_BLOCK);
	if (p==0) p = pos[i]*1000+pos[i+1];
	return p;
}

void del_stuff()
{
	int i, size;
	size = sizeof(stuffs);
	if (size==0) return;
	for (i=0;i<size;i++)
	{
		if (objectp(stuffs[i]))
		{
			stuffs[i]->remove_from_scene();
			destruct(stuffs[i]);
		}
	}
	stuffs = ({ });
}

void reset_stuff()
{
	int i, j, size;
	object npc;
	del_stuff();
	size = sizeof(place1);
	for (i=0;i<size;i++)
	{
		for (j=0;j<3;j++)
		{
			npc = new ("/npc/00/food1");
			if (npc)
			{
				npc->set("z", to_int(place1[i]));
				npc->reset_stuff(npc);
				stuffs += ({ npc });
			}
		}
	}
	size = sizeof(place2);
	for (i=0;i<size;i++)
	{
		for (j=0;j<3;j++)
		{
			npc = new ("/npc/00/food2");
			if (npc)
			{
				npc->set("z", to_int(place2[i]));
				npc->reset_stuff(npc);
				stuffs += ({ npc });
			}
		}
	}	
	
	
	size = sizeof(place3);
	for (i=0;i<size;i++)
	{
		for (j=0;j<3;j++)
		{
			npc = new ("/npc/00/food3");
			if (npc)
			{
				npc->set("z", to_int(place3[i]));
				npc->reset_stuff(npc);
				stuffs += ({ npc });
			}
		}
	}	
	size = sizeof(place4);
	for (i=0;i<size;i++)
	{
		for (j=0;j<3;j++)
		{
			npc = new ("/npc/00/food4");
			if (npc)
			{
				npc->set("z", to_int(place4[i]));
				npc->reset_stuff(npc);
				stuffs += ({ npc });
			}
		}
	}	
/*	
	size = sizeof(place5);
	for (i=0;i<size;i++)
	{
		for (j=0;j<3;j++)
		{
			npc = new ("/npc/00/food5");
			if (npc)
			{
				npc->set("z", to_int(place5[i]));
				npc->reset_stuff(npc);
				stuffs += ({ npc });
			}
		}
	}	
*/	
	size = sizeof(place6);
	for (i=0;i<size;i++)
	{
		for (j=0;j<3;j++)
		{
			npc = new ("/npc/00/food6");
			if (npc)
			{
				npc->set("z", to_int(place6[i]));
				npc->reset_stuff(npc);
				stuffs += ({ npc });
			}
		}
	}	
	size = sizeof(place7);
	for (i=0;i<size;i++)
	{
		for (j=0;j<3;j++)
		{
			npc = new ("/npc/00/food7");
			if (npc)
			{
				npc->set("z", to_int(place7[i]));
				npc->reset_stuff(npc);
				stuffs += ({ npc });
			}
		}
	}	
	size = sizeof(place8);
	for (i=0;i<size;i++)
	{
		for (j=0;j<3;j++)
		{
			npc = new ("/npc/00/food8");
			if (npc)
			{
				npc->set("z", to_int(place8[i]));
				npc->reset_stuff(npc);
				stuffs += ({ npc });
			}
		}
	}	
}

int get_all_stuff()
{
	return sizeof(stuffs);
}

void check_locate()
{
	string * name; 
	int * pos;
	int i, j, size, size2;
	int z;
	name = keys(Locate);
	size2 = sizeof(name);
	for (i=0;i<size2;i++)
	{
		pos = Locate[name[i]];
		size = sizeof(pos);
		for (j=0;j<size/2;j++)
		{
			if (get_valid_xy(to_int(name[i]), pos[2*j], pos[2*j+1], IS_CHAR_BLOCK)==0)
			{
log_file("checkstuff2.dat", sprintf("地图：%s 第几行：%d 坐标(%d,%d)\n", name[i], j+1, pos[2*j], pos[2*j+1]));								
			}
			if (get_block(to_int(name[i]), pos[2*j], pos[2*j+1])&IS_MAP_BLOCK) 
			{
log_file("checkstuff.dat", sprintf("地图：%s 第几行：%d 坐标(%d,%d)\n", name[i], j+1, pos[2*j], pos[2*j+1]));				
			}
		}
	}
}